# User Flow для Auth функціоналу

## Загальний опис

Цей документ описує детальний процес взаємодії користувачів з системою автентифікації — від початкової реєстрації адміністратора через Seed до авторизації, оновлення токенів та обробки помилок. Документ включає користувацькі кроки, API-виклики, валідацію та маршрутизацію.

---

## 1. Реєстрація адміністратора

Реєстрація адміністратора відбувається за допомогою **Seed (унікального коду)**, який надається системою. При першому вході адміністратор зобовʼязаний змінити пароль.

### 1.1 Перший вхід адміністратора

**Дія користувача:**

* Переходить на форму авторизації

**URL:**

```
POST /api/auth/sign-in
```

**UI:**

* Форма входу з двома полями

---

### 1.2 Заповнення форми входу

**Поля форми:**

* `email` — string (електронна пошта адміністратора)
* `password` — string (початковий пароль)

**Валідація:**

* Клієнтська, в реальному часі

---

### 1.3 Обовʼязкова зміна пароля

Після першого успішного входу система вимагає змінити пароль.

**API:**

```
PUT /api/auth/change-password
```

**UI:**

* Форма зміни пароля

**Поля:**

* `newPassword` — string
* `confirmPassword` — string

**Валідація:**

* Відповідність паролів
* Мінімальні вимоги до складності

---

### 1.4 Успішна зміна пароля

**Успішна відповідь (200):**

```json
{
  "accessToken": "jwt_token_here",
  "refreshToken": "refresh_token_here"
}
```

Користувач отримує повідомлення про успіх та перенаправляється на головну сторінку.

---

### 1.5 Стан після авторизації

* Access Token зберігається в cookies (`httpOnly: true`, 30 хв)
* Refresh Token зберігається в `localStorage` (1 день)
* Перехід на `/dashboard`
* У header зʼявляється меню користувача

---

## 2. Реєстрація звичайного користувача

### 2.1 Створення користувача адміністратором

**Дія:**

* Адміністратор створює акаунт через адмін-панель

**API:**

```
POST /api/admin/users/create
```

**Поля:**

* `userName` — string
* `email` — string
* `role` — enum (`user`, `admin`)
* `password` — string (тимчасовий, генерується автоматично)

**Валідація:**

* Клієнтська, в реальному часі

---

### 2.2 Успішне створення

**Відповідь (201):**

```json
{
  "message": "Користувача успішно створено"
}
```

---

## 3. Авторизація користувача

### 3.1 Перехід на сторінку входу

**URL:**

```
/auth/sign-in
```

**UI:**

* Email
* Password
* Посилання "Забули пароль?"

---

### 3.2 Надсилання форми

**API:**

```
POST /api/auth/sign-in
```

**Тіло запиту:**

```json
{
  "email": "user@example.com",
  "password": "securePassword123"
}
```

---

### 3.3 Успішна відповідь

```json
{
  "accessToken": "jwt_token_here",
  "refreshToken": "refresh_token_here"
}
```

**Після входу:**

* Токени зберігаються
* Редірект на `/dashboard`

---

## 4. Вихід з системи

**Дія користувача:**

* Натискає "Вийти"

**API:**

```
POST /api/auth/logout
```

**Результат:**

* Видалення токенів
* Перехід на `/auth/sign-in`

---

## 5. Refresh Token Flow

### 5.1 Оновлення токенів

**Процес:**

1. Запит з простроченим access token
2. Отримання `401 Unauthorized`
3. Виклик refresh endpoint
4. Повтор початкового запиту

**API:**

```
POST /api/auth/refresh?token={refresh_token}
```

**Успішна відповідь:**

```json
{
  "accessToken": "new_jwt_token_here",
  "refreshToken": "new_refresh_token_here"
}
```

---

## 6. Обробка помилок

### Загальні коди помилок

| Код | Опис                             |
| --- | -------------------------------- |
| 400 | Некоректні дані                  |
| 401 | Неавторизований доступ           |
| 404 | Користувач не знайдений          |
| 409 | Email вже зареєстрований         |
| 422 | Токен недійсний або прострочений |
| 429 | Занадто багато запитів           |
| 500 | Помилка сервера                  |

---

### Поведінка UI при помилках

* **422 Invalid token** — пропозиція запросити нове посилання
* **429** — повідомлення про ліміт спроб
* **500** — загальна технічна помилка

---

## 7. Маршрутизація

### Публічні роути

* `/`
* `/auth/sign-up`
* `/auth/sign-in`
* `/auth/forgot-password`
* `/auth/reset-password`
* `/auth/verify-email`

### Захищені роути

* `/dashboard`
* `/admin/create/user*`
* `/admin/delete/user/{userId}`

### Перенаправлення

* Неавторизований → `/auth/sign-in`
* Авторизований → `/dashboard`
* Після логіну → `/dashboard` або останній відвіданий роут
